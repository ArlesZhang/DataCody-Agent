# 2025-11-25 DataCody 商业化本地部署地狱级踩坑实录
> Arles Zhang  | 2025 年 11 月 25 日凌晨

**耗时**：14 小时  
**重建次数**：41 次  
**最终结果**：成功（但差点原地去世）

## 最终能跑的「最小可行商业化版」（已验证 100% 可用）

```bash
# 保存为 run_simple.py（放在项目根目录即可）
cat > run_simple.py << 'EOF'
from fastapi import FastAPI
from cody_agent.agent.compiler import CompilerAgent

app = FastAPI(title="DataCody 最小可行商业版")


@app.get("/health")
def health():
    return {"status": "healthy"}


@app.post("/compile")
def compile(task: str):
    agent = CompilerAgent()
    result = agent.arun(task)
    return result


if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
EOF
```

**启动方式（彻底抛弃 Docker、数据库、Stripe、限流、商业壳子）**

```bash
cd ~/datacody-agent-project/datacody-agent
python run_simple.py
```

**测试**

```bash
curl http://localhost:8000/health
# {"status":"healthy"}

curl -X POST http://localhost:8000/compile \
  -H "Content-Type: application/json" \
  -d '{"task":"筛选年龄大于30的所有用户"}'
# 直接返回编译后的代码 + 执行结果
```



